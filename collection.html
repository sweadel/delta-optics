<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Delta Optics | Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø©</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root { --primary: #00796B; --gold: #D4AF37; --bg: #FAFAFA; }
        * { box-sizing: border-box; font-family: 'Tajawal', sans-serif; }
        body { background: var(--bg); margin: 0; padding-bottom: 0; }
        a { text-decoration: none; color: inherit; }
        
        header { background: white; padding: 15px; display: flex; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 100; }
        .back-btn { font-size: 1.2rem; color: var(--primary); margin-left: 15px; }
        
        .ai-container {
            background: linear-gradient(135deg, #00796B, #004D40);
            color: white; margin: 15px; padding: 20px;
            border-radius: 15px; text-align: center;
            box-shadow: 0 5px 15px rgba(0,121,107,0.3);
        }
        .ai-options { display: flex; gap: 10px; justify-content: center; margin-top: 15px; }
        .ai-btn {
            background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.4);
            color: white; padding: 10px 15px; border-radius: 8px; cursor: pointer;
            flex: 1; font-size: 0.9rem; transition: 0.3s;
        }
        .ai-btn:hover { background: white; color: var(--primary); font-weight: bold; }
        
        #aiResultArea { 
            background: rgba(255,255,255,0.95); color: #333; margin-top: 15px; 
            padding: 15px; border-radius: 10px; display: none; text-align: right; 
            line-height: 1.6; font-size: 0.95rem;
        }
        
        .filter-tabs { display: flex; justify-content: center; gap: 10px; margin: 10px 0; }
        .tab { padding: 6px 20px; border-radius: 20px; background: #fff; border: 1px solid #ddd; cursor: pointer; color: #555; font-size: 0.9rem; }
        .tab.active { background: var(--primary); color: white; border-color: var(--primary); }

        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 12px; padding: 15px; min-height: 300px; }
        .product-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 3px 8px rgba(0,0,0,0.05); border: 1px solid #eee; transition: 0.3s; }
        .img-box { height: 180px; background: #f9f9f9; position: relative; overflow: hidden; display: flex; align-items: center; justify-content: center; }
        .img-box img { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; opacity: 0; }
        .img-box img.loaded { opacity: 1; }
        .info { padding: 10px; text-align: center; }
        
        .wa-btn {
            display: flex; align-items: center; justify-content: center; gap: 5px;
            background: #f0fdf4; color: #166534; padding: 8px; border-radius: 6px;
            font-size: 0.85rem; font-weight: bold; margin-top: 5px;
        }
        
        footer { margin-top: 40px; padding: 30px; background: #263238; color: #ccc; font-size: 0.9rem; border-radius: 20px 20px 0 0; text-align: center; }
        .social-links { margin-top: 15px; font-size: 1.5rem; display: flex; justify-content: center; gap: 20px; }
        .social-links a:hover { color: var(--gold); transform: scale(1.1); transition: 0.3s; }

        #cameraInput { display: none; }
    </style>
</head>
<body>

    <header>
        <a href="index.html" class="back-btn"><i class="fas fa-arrow-right"></i></a>
        <h2 style="margin:0; font-size:1.1rem; color:var(--primary);">Ø§Ù„ØªØ´ÙƒÙŠÙ„Ø©</h2>
    </header>

    <div class="ai-container">
        <h3 style="margin:0;">ğŸ¤– Ù…Ø³ØªØ´Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ø±Ø§Øª</h3>
        <p style="font-size:0.85rem; opacity:0.9; margin:5px 0 15px;">ØµÙˆØ± ÙˆØ¬Ù‡Ùƒ Ù„Ù†Ù‚ØªØ±Ø­ Ø¹Ù„ÙŠÙƒ Ø§Ù„Ø£Ù†Ø³Ø¨</p>
        <div class="ai-options">
            <button class="ai-btn" onclick="triggerCamera()"><i class="fas fa-camera"></i> ØµÙˆØ±Ù†ÙŠ</button>
            <button class="ai-btn" onclick="showManualSelect()"><i class="fas fa-list"></i> Ø§Ø®ØªØ± ÙŠØ¯ÙˆÙŠØ§Ù‹</button>
        </div>
        <input type="file" id="cameraInput" accept="image/*" capture="user" onchange="handleImage(event)">
        <div id="manualSelectDiv" style="display:none; margin-top:15px;">
            <select id="faceShapeSelect" style="width:100%; padding:10px; border-radius:5px;">
                <option value="" disabled selected>-- Ø§Ø®ØªØ± Ø´ÙƒÙ„ ÙˆØ¬Ù‡Ùƒ --</option>
                <option value="Ø¯Ø§Ø¦Ø±ÙŠ">Ø¯Ø§Ø¦Ø±ÙŠ (Round)</option>
                <option value="Ù…Ø±Ø¨Ø¹">Ù…Ø±Ø¨Ø¹ (Square)</option>
                <option value="Ø¨ÙŠØ¶Ø§ÙˆÙŠ">Ø¨ÙŠØ¶Ø§ÙˆÙŠ (Oval)</option>
                <option value="Ù‚Ù„Ø¨ÙŠ">Ù‚Ù„Ø¨ÙŠ (Heart)</option>
            </select>
            <button onclick="analyzeManual()" style="margin-top:10px; background:var(--gold); border:none; padding:8px; border-radius:5px; width:100%; font-weight:bold;">Ø§Ù†ØµØ­Ù†ÙŠ</button>
        </div>
        <div id="aiResultArea"></div>
    </div>

    <div class="filter-tabs">
        <div class="tab active" onclick="filter('all')">Ø§Ù„ÙƒÙ„</div>
        <div class="tab" onclick="filter('medical')">Ø·Ø¨ÙŠØ©</div>
        <div class="tab" onclick="filter('sun')">Ø´Ù…Ø³ÙŠØ©</div>
    </div>

    <div class="gallery-grid" id="galleryContainer"></div>

    <footer>
        <p>Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„ÙŠÙ† - Ø´Ø§Ø±Ø¹ Ø§Ù„ØµØ®Ø±Ø© Ø§Ù„Ù…Ø´Ø±ÙØ©</p>
        <div class="social-links">
            <a href="https://facebook.com/delta.optics1" target="_blank" style="color:white;"><i class="fab fa-facebook"></i></a>
            <a href="https://instagram.com/delta.optics1" target="_blank" style="color:white;"><i class="fab fa-instagram"></i></a>
        </div>
        <p style="margin-top:20px; font-size:0.75rem; opacity:0.6;">Â© 2026 Delta Optics</p>
    </footer>

    <script type="module">
        import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";
        const API_KEY = "AIzaSyABNvhPDxPcRPMSA6ZeRrnLzvJfnKynBHw";
        const genAI = new GoogleGenerativeAI(API_KEY);
        const safetySettings = [{ category: "HARM_CATEGORY_HARASSMENT", threshold: "BLOCK_NONE" },{ category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_NONE" }];

        window.handleImage = async function(event) {
            const file = event.target.files[0];
            if (!file) return;
            const resultDiv = document.getElementById('aiResultArea');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙˆØ¬Ù‡...';
            try {
                const model = genAI.getGenerativeModel({ model: "gemini-2.0-flash", safetySettings });
                const reader = new FileReader();
                reader.onloadend = async () => {
                    const base64Data = reader.result.split(',')[1];
                    const imagePart = { inlineData: { data: base64Data, mimeType: file.type } };
                    const prompt = "Ø­Ù„Ù„ Ø´ÙƒÙ„ ÙˆØ¬Ù‡ Ø§Ù„Ø´Ø®Øµ (Ø¯Ø§Ø¦Ø±ÙŠØŒ Ù…Ø±Ø¨Ø¹ØŸ) ÙˆØ§Ù‚ØªØ±Ø­ 3 Ù†Ø¸Ø§Ø±Ø§Øª. Ø±Ø¯ Ù‚ØµÙŠØ± Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ.";
                    const result = await model.generateContent([prompt, imagePart]);
                    resultDiv.innerHTML = '<strong>ğŸ’¡ Ø§Ù„Ù†ØµÙŠØ­Ø©:</strong><br>' + result.response.text().replace(/\n/g, '<br>');
                };
                reader.readAsDataURL(file);
            } catch (error) { resultDiv.innerHTML = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„.'; }
        }

        window.analyzeManual = async function() {
            const shape = document.getElementById('faceShapeSelect').value;
            if(!shape) return alert("Ø§Ø®ØªØ± Ø§Ù„Ø´ÙƒÙ„");
            const resultDiv = document.getElementById('aiResultArea');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...';
            try {
                const model = genAI.getGenerativeModel({ model: "gemini-2.0-flash", safetySettings });
                const result = await model.generateContent(`ÙˆØ¬Ù‡ÙŠ ${shape}. Ø§Ù‚ØªØ±Ø­ Ù†Ø¸Ø§Ø±Ø§Øª Ù…Ù†Ø§Ø³Ø¨Ø© Ø¨Ø§Ø®ØªØµØ§Ø±.`);
                resultDiv.innerHTML = '<strong>ğŸ’¡ Ø§Ù„Ù†ØµÙŠØ­Ø©:</strong><br>' + result.response.text().replace(/\n/g, '<br>');
            } catch (error) { resultDiv.innerHTML = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„.'; }
        }

        window.triggerCamera = () => document.getElementById('cameraInput').click();
        window.showManualSelect = () => { document.getElementById('manualSelectDiv').style.display = 'block'; document.getElementById('aiResultArea').style.display = 'none'; };
    </script>

    <script>
        const CHECK_LIMIT = 20; 
        document.addEventListener('DOMContentLoaded', () => {
            const container = document.getElementById('galleryContainer');
            let html = '';
            for (let i = 1; i <= CHECK_LIMIT; i++) { html += createCard('medical', i, `m${i}.jpg.jpg`); } 
            for (let i = 1; i <= CHECK_LIMIT; i++) { html += createCard('sun', i, `s${i}.jpg.jpg`); }
            container.innerHTML = html;
        });

        function createCard(type, index, fileName) {
            const typeLabel = type === 'medical' ? 'Ø·Ø¨ÙŠØ©' : 'Ø´Ù…Ø³ÙŠØ©';
            return `
            <div class="product-card ${type}">
                <div class="img-box">
                    <img src="${fileName}" loading="lazy" 
                         onload="this.classList.add('loaded')" 
                         onerror="handleImageError(this, '${type}', ${index})">
                </div>
                <div class="info">
                    <span style="color:var(--gold); font-size:0.75rem; font-weight:bold;">${typeLabel}</span>
                    <h3 style="margin:5px 0; font-size:0.9rem;">Ù…ÙˆØ¯ÙŠÙ„ #${index}</h3>
                    <a href="#" class="wa-btn dynamic-wa" data-filename="${fileName}" data-index="${index}" data-type="${typeLabel}">
                        <i class="fab fa-whatsapp"></i> Ø§Ø³ØªÙØ³Ø§Ø±
                    </a>
                </div>
            </div>`;
        }

        function handleImageError(img, type, index) {
            if (!img.dataset.retried) {
                img.dataset.retried = "true";
                const normalName = type === 'medical' ? `m${index}.jpg` : `s${index}.jpg`;
                img.src = normalName;
                const btn = img.closest('.product-card').querySelector('.dynamic-wa');
                btn.dataset.filename = normalName;
                updateLink(btn);
            } else {
                img.closest('.product-card').remove();
            }
        }

        function filter(category) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            document.querySelectorAll('.product-card').forEach(card => {
                card.style.display = (category === 'all' || card.classList.contains(category)) ? 'block' : 'none';
            });
        }

        function updateLink(btn) {
            const baseUrl = window.location.href.split('collection.html')[0];
            const fullImgUrl = baseUrl + btn.dataset.filename;
            const msg = encodeURIComponent(`Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ø§Ù„Ù†Ø¸Ø§Ø±Ø© ${btn.dataset.type} Ø±Ù‚Ù… #${btn.dataset.index}\nØ§Ù„Ø±Ø§Ø¨Ø·: ${fullImgUrl}`);
            btn.href = `https://wa.me/962775549700?text=${msg}`;
        }
        
        setTimeout(() => document.querySelectorAll('.dynamic-wa').forEach(updateLink), 500);
    </script>
</body>
</html>
