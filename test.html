<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Medical Test | Delta Optics</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root { 
            --brand-color: #0E7490; --gold: #D4AF37; --bg-body: #F8FAFC; 
            --white: #FFFFFF; --text-main: #1E293B; --text-light: #64748B;
            --success: #10B981; --error: #EF4444;
        }

        * { box-sizing: border-box; font-family: 'Tajawal', sans-serif; -webkit-tap-highlight-color: transparent; user-select: none; }
        
        body { background: var(--bg-body); color: var(--text-main); margin: 0; min-height: 100vh; display: flex; flex-direction: column; }

        /* --- الهيدر الجديد (توزيع العناصر) --- */
        header { 
            background: var(--white); 
            height: 60px; padding: 0 20px;
            box-shadow: 0 2px 15px rgba(14, 116, 144, 0.08); 
            display: flex; align-items: center; justify-content: space-between;
            position: sticky; top: 0; z-index: 100;
        }
        
        /* زر اللغة (يسار) */
        .lang-btn {
            background: #F1F5F9; border: 1px solid #E2E8F0; border-radius: 8px;
            padding: 6px 12px; font-weight: 700; color: var(--brand-color);
            cursor: pointer; font-size: 0.9rem; transition: 0.2s; z-index: 2;
        }
        
        /* الحاوية الوسطية (اللوجو والعنوان) - موسطة بدقة */
        .header-center {
            position: absolute; left: 50%; transform: translateX(-50%);
            display: flex; align-items: center; gap: 8px;
            white-space: nowrap;
        }
        .header-logo { width: 35px; height: 35px; object-fit: contain; }
        .header-title { font-weight: 800; font-size: 1.1rem; color: var(--brand-color); margin: 0; }

        /* زر الخروج (يمين) */
        .back-btn { 
            width: 38px; height: 38px; border-radius: 50%; background: #F1F5F9; 
            color: var(--text-main); display: flex; align-items: center; justify-content: center;
            text-decoration: none; font-size: 1.1rem; z-index: 2;
            transition: 0.2s;
        }
        .back-btn:active { background: var(--error); color: white; }

        /* --- الحاوية والشاشات --- */
        .container { flex: 1; padding: 20px; max-width: 500px; margin: 0 auto; width: 100%; display: flex; flex-direction: column; align-items: center; }
        .screen { display: none; width: 100%; animation: fadeIn 0.4s ease-out; }
        .screen.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- القائمة الرئيسية واللوجو الكبير --- */
        .welcome-box { text-align: center; margin-bottom: 30px; padding: 20px; }
        
        /* تعديل اللوجو الكبير والحركة */
        .welcome-logo { 
            width: 120px; height: 120px; /* تكبير الحجم */
            object-fit: contain; margin-bottom: 20px; 
            animation: pulseLogo 3s infinite ease-in-out; /* حركة النبض */
            filter: drop-shadow(0 5px 15px rgba(14, 116, 144, 0.15));
        }

        @keyframes pulseLogo {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); } /* يكبر شوي */
            100% { transform: scale(1); }
        }

        /* باقي الستايلات (نفس السابقة) */
        .menu-grid { display: grid; gap: 15px; }
        .test-card { 
            background: var(--white); padding: 20px; border-radius: 16px; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.03); cursor: pointer; 
            display: flex; align-items: center; gap: 15px; border: 1px solid #E2E8F0;
        }
        .test-card:active { transform: scale(0.98); background: #F8FAFC; }
        .icon-wrap { width: 50px; height: 50px; background: #ECFEFF; border-radius: 14px; display: flex; align-items: center; justify-content: center; color: var(--brand-color); font-size: 1.5rem; }
        
        /* تدوير السهم حسب اللغة */
        html[dir="rtl"] .arrow-icon { transform: rotate(0deg); }
        html[dir="ltr"] .arrow-icon { transform: rotate(180deg); }

        /* مناطق الفحص */
        .test-area {
            background: var(--white); border-radius: 20px; padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05); text-align: center;
            margin-bottom: 20px; min-height: 300px; 
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            border: 1px solid #E2E8F0;
        }
        .instruction { 
            background: #FFFBEB; color: #B45309; padding: 8px 15px; 
            border-radius: 20px; font-size: 0.85rem; display: inline-block; margin-bottom: 20px;
            border: 1px solid #FEF3C7;
        }
        .controls-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; max-width: 240px; margin: 0 auto; }
        .ctrl-btn { height: 60px; background: var(--white); border: 1px solid #CBD5E1; border-radius: 12px; font-size: 1.3rem; cursor: pointer; color: var(--brand-color); box-shadow: 0 4px 0 #CBD5E1; }
        .ctrl-btn:active { transform: translateY(4px); box-shadow: none; }
        
        .e-char { font-weight: 900; line-height: 1; transition: 0.2s; }
        .color-canvas { background: #fff; border-radius: 50%; width: 260px; height: 260px; margin-bottom: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); }
        .amsler-grid { width: 280px; height: 280px; background: #fff; background-image: linear-gradient(#000 1px, transparent 1px), linear-gradient(90deg, #000 1px, transparent 1px); background-size: 20px 20px; border: 2px solid #000; position: relative; display: flex; justify-content: center; align-items: center; }
        .center-dot { width: 8px; height: 8px; background: #000; border-radius: 50%; }

        .numpad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; max-width: 280px; margin: 0 auto; }
        .num-key { padding: 15px; border: none; background: #F1F5F9; border-radius: 10px; font-size: 1.2rem; font-weight: 700; color: var(--text-main); cursor: pointer; }

        /* التقرير */
        .report-card { background: var(--white); border-radius: 20px; overflow: hidden; box-shadow: 0 10px 40px rgba(14, 116, 144, 0.15); border: 1px solid #E2E8F0; text-align: center; }
        .report-header { background: var(--brand-color); color: white; padding: 20px; }
        .report-body { padding: 30px 20px; }
        .score-display { font-size: 2.5rem; font-weight: 800; color: var(--brand-color); margin-bottom: 5px; display: block; }
        
        .action-btn { width: 100%; padding: 16px; border-radius: 12px; border: none; font-weight: 700; font-size: 1rem; cursor: pointer; margin-bottom: 10px; display: flex; justify-content: center; gap: 8px; align-items: center; text-decoration: none; }
        .btn-primary { background: var(--gold); color: #000; }
        .btn-outline { background: transparent; border: 2px solid #E2E8F0; color: var(--text-light); }

    </style>
</head>
<body>

    <header>
        <a href="index.html" class="back-btn"><i class="fas fa-times"></i></a>

        <div class="header-center">
            <img src="logo.jpg" class="header-logo" alt="Delta" onerror="this.style.display='none'">
            <h1 class="header-title" id="txt-app-title">العيادة الذكية</h1>
        </div>

        <button class="lang-btn" onclick="toggleLang()">EN</button>
    </header>

    <div class="container">

        <div id="menu" class="screen active">
            <div class="welcome-box">
                <img src="logo.jpg" class="welcome-logo" alt="Logo" onerror="this.src='https://via.placeholder.com/100?text=Delta'">
                <h2 id="txt-welcome">أهلاً بك في فحص دلتا</h2>
                <p id="txt-subtitle">تقنية طبية متطورة لفحص دقيق</p>
            </div>

            <div class="menu-grid">
                <div class="test-card" onclick="startVision()">
                    <div class="icon-wrap"><i class="fas fa-eye"></i></div>
                    <div class="card-info" style="flex:1">
                        <h3 id="txt-t1-title">حدة النظر (Snellen)</h3>
                        <p id="txt-t1-desc">قياس دقة الإبصار عن بعد</p>
                    </div>
                    <i class="fas fa-chevron-left arrow-icon" style="color:#CBD5E1;"></i>
                </div>

                <div class="test-card" onclick="startColor()">
                    <div class="icon-wrap"><i class="fas fa-palette"></i></div>
                    <div class="card-info" style="flex:1">
                        <h3 id="txt-t2-title">عمى الألوان (Ishihara)</h3>
                        <p id="txt-t2-desc">اختبار التمييز اللوني الدقيق</p>
                    </div>
                    <i class="fas fa-chevron-left arrow-icon" style="color:#CBD5E1;"></i>
                </div>

                <div class="test-card" onclick="startAmsler()">
                    <div class="icon-wrap"><i class="fas fa-border-all"></i></div>
                    <div class="card-info" style="flex:1">
                        <h3 id="txt-t3-title">فحص الشبكية (Amsler)</h3>
                        <p id="txt-t3-desc">للكشف عن البقع العمياء</p>
                    </div>
                    <i class="fas fa-chevron-left arrow-icon" style="color:#CBD5E1;"></i>
                </div>
            </div>
        </div>

        <div id="test-vision" class="screen">
            <div class="instruction" id="txt-v-instr"><i class="fas fa-ruler-horizontal"></i> المسافة المطلوبة: 40 سم</div>
            <div class="test-area">
                <div id="e-char" class="e-char">E</div>
            </div>
            <div class="controls-grid">
                <button class="ctrl-btn" style="grid-column:2" onclick="checkVision(270)"><i class="fas fa-chevron-up"></i></button>
                <button class="ctrl-btn" style="grid-column:1; grid-row:2" onclick="checkVision(180)"><i class="fas fa-chevron-left"></i></button>
                <button class="ctrl-btn" style="grid-column:2; grid-row:2" onclick="checkVision(90)"><i class="fas fa-chevron-down"></i></button>
                <button class="ctrl-btn" style="grid-column:3; grid-row:2" onclick="checkVision(0)"><i class="fas fa-chevron-right"></i></button>
            </div>
        </div>

        <div id="test-color" class="screen">
            <div class="instruction" id="txt-c-instr"><i class="fas fa-sun"></i> ارفع سطوع الشاشة</div>
            <div style="display:flex; justify-content:center; margin-bottom:10px;">
                <canvas id="ishiharaCanvas" width="260" height="260" class="color-canvas"></canvas>
            </div>
            <div id="color-display" style="text-align:center; height:30px; font-size:1.5rem; font-weight:bold; color:var(--brand-color); margin-bottom:15px;"></div>
            <div class="numpad">
                <script>for(let i=1;i<=9;i++)document.write(`<button class="num-key" onclick="typeColor(${i})">${i}</button>`)</script>
                <button class="num-key" style="color:var(--error)" onclick="clearColor()"><i class="fas fa-backspace"></i></button>
                <button class="num-key" onclick="typeColor(0)">0</button>
                <button class="num-key" style="background:var(--success); color:white;" onclick="checkColor()"><i class="fas fa-check"></i></button>
            </div>
        </div>

        <div id="test-amsler" class="screen">
            <div class="instruction" id="txt-a-instr"><i class="fas fa-eye-slash"></i> غطِ عين واحدة وانظر للمركز</div>
            <div class="test-area" style="min-height:auto; padding:30px 0;">
                <div class="amsler-grid"><div class="center-dot"></div></div>
            </div>
            <h4 id="txt-a-q" style="text-align:center; margin:0 0 15px;">هل الخطوط مستقيمة تماماً؟</h4>
            <button id="btn-a-yes" class="action-btn" style="background:var(--bg-body); border:1px solid #ccc; color:var(--text-main);" onclick="finishAmsler(true)">نعم، سليمة</button>
            <button id="btn-a-no" class="action-btn" style="background:#FEF2F2; border:1px solid #FECACA; color:var(--error);" onclick="finishAmsler(false)">لا، يوجد تعرج</button>
        </div>

        <div id="result" class="screen">
            <div class="report-card">
                <div class="report-header">
                    <h2 id="txt-rep-title">التقرير الطبي</h2>
                    <p id="txt-rep-sub">نتائج الفحص الأولي</p>
                </div>
                <div class="report-body">
                    <span id="res-score" class="score-display">--</span>
                    <span id="res-desc" class="score-label">--</span>
                    <div style="background:#F0F9FF; padding:15px; border-radius:10px; font-size:0.85rem; color:#0369A1; margin-bottom:25px; line-height:1.5;">
                        <i class="fas fa-info-circle"></i> <span id="txt-disclaimer">هذه النتيجة تقريبية ولا تغني عن الفحص السريري. نتشرف بزيارتك في فرع المقابلين.</span>
                    </div>
                    <a id="wa-btn" href="#" class="action-btn btn-primary">
                        <i class="fab fa-whatsapp"></i> <span id="txt-book">حجز موعد</span>
                    </a>
                    <button onclick="location.reload()" class="action-btn btn-outline" id="txt-retry">
                        إعادة الفحص
                    </button>
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- القاموس ---
        const i18n = {
            ar: {
                appTitle: "العيادة الذكية",
                welcome: "أهلاً بك في فحص دلتا",
                subtitle: "تقنية طبية متطورة لفحص دقيق",
                t1Title: "حدة النظر (Snellen)", t1Desc: "قياس دقة الإبصار عن بعد",
                t2Title: "عمى الألوان (Ishihara)", t2Desc: "اختبار التمييز اللوني الدقيق",
                t3Title: "فحص الشبكية (Amsler)", t3Desc: "للكشف عن البقع العمياء",
                vInstr: "المسافة المطلوبة: 40 سم", cInstr: "ارفع سطوع الشاشة", aInstr: "غطِ عين واحدة وانظر للمركز",
                aQ: "هل الخطوط مستقيمة تماماً؟", btnYes: "نعم، سليمة", btnNo: "لا، يوجد تعرج",
                repTitle: "التقرير الطبي", repSub: "نتائج الفحص الأولي",
                disclaimer: "هذه النتيجة تقريبية ولا تغني عن الفحص السريري. نتشرف بزيارتك في فرع المقابلين.",
                book: "حجز موعد بالنتيجة", retry: "إعادة الفحص",
                resVision: "حدة النظر", resColor: "رؤية الألوان", resAmsler: "فحص الشبكية",
                perfect: "ممتاز", good: "طبيعي", bad: "يحتاج فحص", waMsg: "مرحبا دلتا، قمت بالفحص وكانت النتيجة:"
            },
            en: {
                appTitle: "Smart Clinic",
                welcome: "Welcome to Delta Check",
                subtitle: "Advanced medical tech for accurate screening",
                t1Title: "Visual Acuity (Snellen)", t1Desc: "Measure distance vision",
                t2Title: "Color Blindness (Ishihara)", t2Desc: "Precise color perception test",
                t3Title: "Amsler Grid (Retina)", t3Desc: "Detect blind spots & distortion",
                vInstr: "Required Distance: 40 cm", cInstr: "Increase Screen Brightness", aInstr: "Cover one eye & focus on center",
                aQ: "Are all lines perfectly straight?", btnYes: "Yes, Straight", btnNo: "No, Distorted",
                repTitle: "Medical Report", repSub: "Preliminary Screening Results",
                disclaimer: "This is a screening test and does not replace a clinical exam. Please visit our branch.",
                book: "Book Appointment", retry: "Retry Test",
                resVision: "Visual Acuity", resColor: "Color Vision", resAmsler: "Amsler Grid",
                perfect: "Excellent", good: "Normal", bad: "Check Required", waMsg: "Hi Delta, I did the test and the result was:"
            }
        };

        let curLang = 'ar';

        function toggleLang() {
            curLang = curLang === 'ar' ? 'en' : 'ar';
            const langBtn = document.querySelector('.lang-btn');
            const html = document.documentElement;
            const t = i18n[curLang];

            html.lang = curLang; html.dir = curLang === 'ar' ? 'rtl' : 'ltr';
            langBtn.innerText = curLang === 'ar' ? 'EN' : 'عربي';

            // تحديث النصوص
            document.getElementById('txt-app-title').innerText = t.appTitle;
            document.getElementById('txt-welcome').innerText = t.welcome;
            document.getElementById('txt-subtitle').innerText = t.subtitle;
            document.getElementById('txt-t1-title').innerText = t.t1Title;
            document.getElementById('txt-t1-desc').innerText = t.t1Desc;
            document.getElementById('txt-t2-title').innerText = t.t2Title;
            document.getElementById('txt-t2-desc').innerText = t.t2Desc;
            document.getElementById('txt-t3-title').innerText = t.t3Title;
            document.getElementById('txt-t3-desc').innerText = t.t3Desc;
            document.getElementById('txt-v-instr').innerHTML = `<i class="fas fa-ruler-horizontal"></i> ${t.vInstr}`;
            document.getElementById('txt-c-instr').innerHTML = `<i class="fas fa-sun"></i> ${t.cInstr}`;
            document.getElementById('txt-a-instr').innerHTML = `<i class="fas fa-eye-slash"></i> ${t.aInstr}`;
            document.getElementById('txt-a-q').innerText = t.aQ;
            document.getElementById('btn-a-yes').innerText = t.btnYes;
            document.getElementById('btn-a-no').innerText = t.btnNo;
            document.getElementById('txt-rep-title').innerText = t.repTitle;
            document.getElementById('txt-rep-sub').innerText = t.repSub;
            document.getElementById('txt-disclaimer').innerText = t.disclaimer;
            document.getElementById('txt-book').innerText = t.book;
            document.getElementById('txt-retry').innerText = t.retry;
        }

        function show(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        // --- Logic ---
        const vSizes = [130, 100, 70, 50, 35, 25]; 
        const vLabels = ["6/60", "6/36", "6/24", "6/18", "6/12", "6/6"];
        let vStep = 0, vRot = 0, vErrors = 0;

        function startVision() { vStep=0; vErrors=0; updateE(); show('test-vision'); }
        function updateE() {
            if(vStep >= vSizes.length) { endVision(true); return; }
            const e = document.getElementById('e-char');
            vRot = [0, 90, 180, 270][Math.floor(Math.random()*4)];
            e.style.fontSize = vSizes[vStep] + "px";
            e.style.transform = `rotate(${vRot}deg)`;
        }
        function checkVision(dir) {
            if(dir === vRot) { vStep++; updateE(); } 
            else { vErrors++; if(vErrors > 1) endVision(false); else updateE(); }
        }
        function endVision(perfect) {
            let score = vStep > 0 ? vLabels[vStep-1] : "< 6/60";
            if(perfect) score = "6/6";
            showResult(i18n[curLang].resVision, score, perfect ? i18n[curLang].perfect : i18n[curLang].bad);
        }

        let cRound = 0, cScore = 0, cInput = "";
        const cTests = [12, 5, 29, 74, 6]; 
        function startColor() { cRound=0; cScore=0; nextColorPlate(); show('test-color'); }
        function nextColorPlate() {
            if(cRound >= cTests.length) {
                let res = cScore >= 4 ? i18n[curLang].good : i18n[curLang].bad;
                showResult(i18n[curLang].resColor, res, `${cScore}/${cTests.length}`);
                return;
            }
            cInput = ""; document.getElementById('color-display').innerText = "";
            generateIshiharaPlate(cTests[cRound]);
        }
        function generateIshiharaPlate(number) {
            const canvas = document.getElementById('ishiharaCanvas');
            const ctx = canvas.getContext('2d');
            const size = 260; ctx.clearRect(0, 0, size, size);
            const maskCanvas = document.createElement('canvas');
            maskCanvas.width = size; maskCanvas.height = size;
            const maskCtx = maskCanvas.getContext('2d');
            maskCtx.font = "bold 150px Arial"; maskCtx.textAlign = "center"; maskCtx.textBaseline = "middle";
            maskCtx.fillText(number, size/2, size/2);
            const maskData = maskCtx.getImageData(0,0,size,size);
            const dots = [];
            for(let i=0; i<2000; i++) {
                let r = Math.random() * 5 + 2; let x = Math.random() * size; let y = Math.random() * size;
                if(Math.sqrt((x - size/2)**2 + (y - size/2)**2) > 125) continue; 
                let overlap = false;
                for(let d of dots) { if(Math.sqrt((d.x - x)**2 + (d.y - y)**2) < d.r + r + 1) { overlap = true; break; } }
                if(overlap) continue;
                let pIndex = (Math.floor(y) * size + Math.floor(x)) * 4;
                let isNum = maskData.data[pIndex + 3] > 100;
                let color = isNum ? `rgb(${220+Math.random()*35}, ${50+Math.random()*100}, 40)` : `rgb(${80+Math.random()*50}, ${160+Math.random()*60}, ${140+Math.random()*60})`;
                dots.push({x, y, r, color});
            }
            for(let d of dots) { ctx.beginPath(); ctx.arc(d.x, d.y, d.r, 0, Math.PI*2); ctx.fillStyle = d.color; ctx.fill(); }
        }
        function typeColor(n) { if(cInput.length < 2) cInput += n; document.getElementById('color-display').innerText = cInput; }
        function clearColor() { cInput = ""; document.getElementById('color-display').innerText = ""; }
        function checkColor() { if(parseInt(cInput) === cTests[cRound]) cScore++; cRound++; nextColorPlate(); }

        function startAmsler() { show('test-amsler'); }
        function finishAmsler(isGood) {
            showResult(i18n[curLang].resAmsler, isGood ? i18n[curLang].good : i18n[curLang].bad, isGood ? i18n[curLang].perfect : "Distortion");
        }

        function showResult(title, score, desc) {
            show('result');
            document.getElementById('res-score').innerText = score;
            document.getElementById('res-desc').innerText = `${title}: ${desc}`;
            let waMsg = `${i18n[curLang].waMsg} (${title} -> ${score})`;
            document.getElementById('wa-btn').href = `https://wa.me/962775549700?text=${encodeURIComponent(waMsg)}`;
        }
    </script>
</body>
</html>
