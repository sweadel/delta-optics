<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Delta Optics | ÙØ­Øµ Ø§Ù„Ù†Ø¸Ø± Ø§Ù„Ø°ÙƒÙŠ</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root { --primary: #00796B; --gold: #D4AF37; --bg: #e0f2f1; --text: #37474F; --success: #4CAF50; --error: #F44336; }
        * { box-sizing: border-box; font-family: 'Tajawal', sans-serif; -webkit-tap-highlight-color: transparent; user-select: none; }
        body { background: var(--bg); color: var(--text); overflow: hidden; margin: 0; height: 100vh; display: flex; flex-direction: column; }
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        header { background: #fff; padding: 15px 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); display: flex; align-items: center; justify-content: space-between; z-index: 100; }
        .back-btn { font-size: 1rem; color: var(--text); text-decoration: none; font-weight: bold; display: flex; align-items: center; gap: 5px; transition: 0.3s; }
        .back-btn:hover { color: var(--primary); }
        .logo-text { font-size: 1.1rem; font-weight: 800; color: var(--primary); }

        /* Ø²Ø± Ø§Ù„ØµÙˆØª */
        .sound-toggle { background: none; border: none; font-size: 1.2rem; color: var(--primary); cursor: pointer; padding: 5px; transition: 0.3s; }
        .sound-toggle:hover { color: var(--gold); }

        /* Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        .test-container { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; position: relative; }
        
        /* Ø§Ù„Ø´Ø§Ø´Ø§Øª */
        .screen { display: none; width: 100%; max-width: 450px; text-align: center; animation: fadeIn 0.5s ease; background: rgba(255,255,255,0.85); backdrop-filter: blur(10px); padding: 30px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); border: 1px solid rgba(255,255,255,0.6); }
        .screen.active { display: block; }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© */
        .icon-pulse { font-size: 4rem; color: var(--primary); margin-bottom: 20px; animation: pulse 2s infinite; }
        .instructions { font-size: 1rem; color: #666; margin-bottom: 30px; line-height: 1.8; background: #fff; padding: 15px; border-radius: 15px; text-align: right; border-right: 4px solid var(--gold); }
        .start-btn { background: linear-gradient(45deg, var(--primary), #004D40); color: white; padding: 15px 50px; border-radius: 50px; font-weight: 800; font-size: 1.2rem; border: none; cursor: pointer; box-shadow: 0 5px 15px rgba(0,121,107,0.4); transition: 0.3s; width: 100%; }
        .start-btn:active { transform: scale(0.98); }

        /* Ø´Ø§Ø´Ø© Ø§Ù„ÙØ­Øµ */
        .progress-bar { width: 100%; height: 8px; background: #ddd; border-radius: 10px; margin-bottom: 20px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--primary); width: 0%; transition: 0.3s; }
        
        .e-display { width: 220px; height: 220px; background: #fff; border-radius: 20px; display: flex; align-items: center; justify-content: center; margin: 0 auto 30px; box-shadow: inset 0 0 20px rgba(0,0,0,0.05); border: 2px solid #eee; position: relative; }
        #testChar { font-family: sans-serif; font-weight: 900; transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); line-height: 1; color: #000; }
        
        .controls { display: grid; grid-template-columns: 70px 70px 70px; gap: 10px; justify-content: center; }
        .ctrl-btn { width: 70px; height: 70px; background: #fff; border: 1px solid #e0e0e0; border-radius: 18px; font-size: 1.8rem; color: var(--primary); cursor: pointer; box-shadow: 0 4px 0 #ddd; transition: 0.1s; }
        .ctrl-btn:active { transform: translateY(4px); box-shadow: none; background: #f9f9f9; }
        .btn-up { grid-column: 2; } .btn-left { grid-column: 1; grid-row: 2; } .btn-right { grid-column: 3; grid-row: 2; } .btn-down { grid-column: 2; grid-row: 2; }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø© */
        .score-circle { width: 140px; height: 140px; border: 8px solid var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2.2rem; font-weight: 800; color: var(--primary); margin: 0 auto 20px; background: #fff; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .result-msg { font-size: 1.2rem; font-weight: bold; margin-bottom: 20px; }
        .wa-btn { background: #25D366; color: white; padding: 12px; border-radius: 12px; text-decoration: none; display: block; font-weight: bold; margin-top: 15px; box-shadow: 0 4px 10px rgba(37, 211, 102, 0.3); }

        .feedback-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; opacity: 0; transition: 0.3s; z-index: 50; }
        
        @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.1); opacity: 0.8; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="feedback" class="feedback-overlay"></div>

    <header>
        <a href="index.html" class="back-btn"><i class="fas fa-arrow-right"></i> Ø®Ø±ÙˆØ¬</a>
        <span class="logo-text">ÙØ­Øµ Ø§Ù„Ù†Ø¸Ø±</span>
        <button class="sound-toggle" onclick="toggleMute()" id="muteBtn"><i class="fas fa-volume-up"></i></button>
    </header>

    <div class="test-container">
        <div id="screen-start" class="screen active">
            <i class="fas fa-eye icon-pulse"></i>
            <h2 style="margin:0 0 10px 0; color:var(--primary);">ÙØ­Øµ Ø§Ù„Ù†Ø¸Ø± Ø§Ù„Ø³Ø±ÙŠØ¹</h2>
            <div class="instructions">
                <p><i class="fas fa-ruler-horizontal" style="color:var(--primary)"></i> <b>Ø§Ù„Ù…Ø³Ø§ÙØ©:</b> Ø§Ø¨Ø¹Ø¯ Ø§Ù„Ù‡Ø§ØªÙ 40 Ø³Ù….</p>
                <p><i class="fas fa-volume-up" style="color:var(--primary)"></i> <b>Ø§Ù„ØµÙˆØª:</b> Ø§Ø±ÙØ¹ Ø§Ù„ØµÙˆØª Ù„ØªØ¬Ø±Ø¨Ø© Ø£ÙØ¶Ù„.</p>
            </div>
            <button class="start-btn" onclick="startGame()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ğŸš€</button>
        </div>

        <div id="screen-game" class="screen">
            <div class="progress-bar"><div id="progress" class="progress-fill"></div></div>
            <div class="e-display"><div id="testChar">E</div></div>
            <p style="margin: -15px 0 15px; font-size:0.9rem; color:#777;">Ø­Ø¯Ø¯ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„ÙØªØ­Ø©</p>
            <div class="controls">
                <button class="ctrl-btn btn-up" onclick="checkAnswer(270)"><i class="fas fa-chevron-up"></i></button>
                <button class="ctrl-btn btn-left" onclick="checkAnswer(180)"><i class="fas fa-chevron-left"></i></button>
                <button class="ctrl-btn btn-down" onclick="checkAnswer(90)"><i class="fas fa-chevron-down"></i></button>
                <button class="ctrl-btn btn-right" onclick="checkAnswer(0)"><i class="fas fa-chevron-right"></i></button>
            </div>
        </div>

        <div id="screen-result" class="screen">
            <h3 style="color:#555;">Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠØ©</h3>
            <div class="score-circle" id="final-score">6/6</div>
            <div id="result-text" class="result-msg">Ù…Ù…ØªØ§Ø²!</div>
            <div style="background:#f9f9f9; padding:15px; border-radius:15px; text-align:right; font-size:0.9rem;">
                <p style="margin:0 0 5px;">ğŸ©º <b>ØªÙˆØµÙŠØ© Ø¯Ù„ØªØ§ Ù„Ù„Ø¨ØµØ±ÙŠØ§Øª:</b></p>
                <p id="recommendation" style="margin:0; color:#555;">ÙŠØ±Ø¬Ù‰ Ø²ÙŠØ§Ø±ØªÙ†Ø§ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ÙØ­Øµ Ø¯Ù‚ÙŠÙ‚.</p>
            </div>
            <a href="#" id="wa-share" class="wa-btn" target="_blank"><i class="fab fa-whatsapp"></i> Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯</a>
            <button onclick="location.reload()" style="background:none; border:none; color:#777; margin-top:15px; cursor:pointer;">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ÙØ­Øµ</button>
        </div>
    </div>

    <script>
        const levels = [120, 90, 70, 50, 40, 30, 20, 10]; 
        const scores = ["Ø£Ù‚Ù„ Ù…Ù† 6/60", "6/60", "6/36", "6/24", "6/18", "6/12", "6/9", "6/6"];
        
        let currentLevel = 0;
        let currentRotation = 0; 
        let mistakes = 0;
        let isMuted = false;

        // --- Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙˆØª Ø§Ù„Ù…Ø·ÙˆØ± ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playTone(type) {
            if (isMuted) return;
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);

            if (type === 'correct') { // Ù†ØºÙ…Ø© Ù†Ø¬Ø§Ø­ (Ø¹Ø§Ù„ÙŠØ© ÙˆÙ…ØªØµØ§Ø¹Ø¯Ø©)
                osc.type = 'sine';
                osc.frequency.setValueAtTime(600, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                osc.start(); osc.stop(audioCtx.currentTime + 0.3);
            } else { // Ù†ØºÙ…Ø© Ø®Ø·Ø£ (Ù…Ù†Ø®ÙØ¶Ø© ÙˆÙ‡Ø§Ø¨Ø·Ø©)
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.2);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                osc.start(); osc.stop(audioCtx.currentTime + 0.3);
            }
        }

        function toggleMute() {
            isMuted = !isMuted;
            document.getElementById('muteBtn').innerHTML = isMuted ? '<i class="fas fa-volume-mute"></i>' : '<i class="fas fa-volume-up"></i>';
        }

        // --- Ù…Ù†Ø·Ù‚ Ø§Ù„Ù„Ø¹Ø¨Ø© ---
        function startGame() {
            showScreen('screen-game');
            // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù€ Audio Context Ø¹Ù†Ø¯ Ø£ÙˆÙ„ ØªÙØ§Ø¹Ù„
            if (audioCtx.state === 'suspended') audioCtx.resume();
            loadLevel();
        }

        function loadLevel() {
            if (currentLevel >= levels.length) { finishTest(true); return; }
            let progress = ((currentLevel) / levels.length) * 100;
            document.getElementById('progress').style.width = progress + '%';
            const char = document.getElementById('testChar');
            char.style.fontSize = levels[currentLevel] + 'px';
            const rotations = [0, 90, 180, 270];
            let newRotation = currentRotation;
            while(newRotation === currentRotation) { newRotation = rotations[Math.floor(Math.random() * rotations.length)]; }
            currentRotation = newRotation;
            char.style.transform = `rotate(${currentRotation}deg)`;
        }

        function checkAnswer(userChoice) {
            const feedback = document.getElementById('feedback');
            if (userChoice === currentRotation) {
                playTone('correct'); // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª
                feedback.style.background = 'rgba(76, 175, 80, 0.2)';
                feedback.style.opacity = '1';
                setTimeout(() => feedback.style.opacity = '0', 200);
                currentLevel++; loadLevel();
            } else {
                playTone('wrong'); // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª
                feedback.style.background = 'rgba(244, 67, 54, 0.2)';
                feedback.style.opacity = '1';
                setTimeout(() => feedback.style.opacity = '0', 200);
                mistakes++;
                if (mistakes > 1) { finishTest(false); } else { loadLevel(); }
            }
        }

        function finishTest(completed) {
            showScreen('screen-result');
            playTone('correct'); // Ù†ØºÙ…Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
            let finalScore = (currentLevel > 0) ? scores[currentLevel - 1] : "Ø¶Ø¹ÙŠÙ Ø¬Ø¯Ø§Ù‹";
            if (completed) finalScore = "6/6";
            
            const scoreEl = document.getElementById('final-score');
            const msgEl = document.getElementById('result-text');
            const recEl = document.getElementById('recommendation');
            const waBtn = document.getElementById('wa-share');

            scoreEl.textContent = finalScore;
            if (currentLevel >= 6) {
                scoreEl.style.borderColor = "#4CAF50"; scoreEl.style.color = "#4CAF50";
                msgEl.textContent = "Ù†Ø¸Ø± Ù…Ù…ØªØ§Ø²!"; recEl.textContent = "Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ ØµØ­Ø© Ø¹ÙŠÙ†ÙŠÙƒ.";
            } else {
                scoreEl.style.borderColor = "#F44336"; scoreEl.style.color = "#F44336";
                msgEl.textContent = "ØªØ­ØªØ§Ø¬ Ù„Ù†Ø¸Ø§Ø±Ø©"; recEl.textContent = "Ø§Ù„ÙØ­Øµ Ø§Ù„Ø·Ø¨ÙŠ Ø¶Ø±ÙˆØ±ÙŠ Ø¬Ø¯Ø§Ù‹.";
            }
            waBtn.href = `https://wa.me/962775549700?text=Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ù†ØªÙŠØ¬ØªÙŠ ÙÙŠ Ø§Ù„ÙØ­Øµ: ${finalScore}`;
        }

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }
    </script>
</body>
</html>
